<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CryptoTracker Pro - Smart Portfolio Manager</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #0f172a;
            --dark-secondary: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #cbd5e1;
            --card-bg: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            --gradient-danger: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        [data-theme="dark"] {
            --card-bg: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --light: #0f172a;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--light);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        [data-theme="dark"] body {
            background: linear-gradient(to bottom, #0f172a, #1e293b);
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 80px; /* –¥–ª—è bottom nav */
        }
        
        /* Header Styles */
        .header {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }
        
        [data-theme="dark"] .header {
            background: rgba(30, 41, 59, 0.9);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
        }
        
        .theme-toggle:hover {
            transform: scale(1.05);
            border-color: var(--primary);
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(99, 102, 241, 0.05) 100%);
            padding: 15px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .stat-change {
            font-size: 12px;
            margin-top: 5px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            border-radius: 6px;
            font-weight: 600;
        }
        
        .stat-change.positive {
            color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .stat-change.negative {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* Tabs */
        .tabs-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .tabs::-webkit-scrollbar {
            display: none;
        }
        
        .tab {
            padding: 12px 20px;
            border-radius: 15px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .tab:hover {
            background: rgba(99, 102, 241, 0.05);
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
        }
        
        .tab-icon {
            font-size: 16px;
        }
        
        /* Content Area */
        .content-area {
            min-height: 400px;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        /* Portfolio Table */
        .portfolio-grid {
            display: grid;
            gap: 15px;
        }
        
        .portfolio-item {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .portfolio-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateX(2px);
        }
        
        .portfolio-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .token-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .token-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            box-shadow: var(--shadow-sm);
        }
        
        .token-details {
            display: flex;
            flex-direction: column;
        }
        
        .token-symbol {
            font-weight: 700;
            font-size: 16px;
            color: var(--text-primary);
        }
        
        .token-name {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .token-price {
            text-align: right;
        }
        
        .current-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .price-change {
            font-size: 12px;
            font-weight: 600;
        }
        
        .portfolio-item-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }
        
        .item-stat {
            display: flex;
            flex-direction: column;
        }
        
        .item-stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }
        
        .item-stat-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Alerts Section */
        .alerts-list {
            display: grid;
            gap: 12px;
        }
        
        .alert-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 12px;
            border-left: 4px solid;
            transition: all 0.3s;
        }
        
        .alert-item:hover {
            transform: translateX(5px);
        }
        
        .alert-item.buy {
            border-left-color: var(--success);
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, var(--card-bg) 100%);
        }
        
        .alert-item.sell {
            border-left-color: var(--danger);
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.1) 0%, var(--card-bg) 100%);
        }
        
        .alert-item.info {
            border-left-color: var(--info);
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.1) 0%, var(--card-bg) 100%);
        }
        
        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: rgba(255, 255, 255, 0.5);
        }
        
        [data-theme="dark"] .alert-icon {
            background: rgba(0, 0, 0, 0.2);
        }
        
        .alert-content {
            flex: 1;
        }
        
        .alert-title {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        
        .alert-description {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .alert-time {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        /* History */
        .history-list {
            display: grid;
            gap: 10px;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            transition: all 0.3s;
        }
        
        .history-item:hover {
            box-shadow: var(--shadow-sm);
        }
        
        .history-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .history-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .history-icon.buy {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .history-icon.sell {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }
        
        .history-details {
            display: flex;
            flex-direction: column;
        }
        
        .history-title {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .history-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .history-right {
            text-align: right;
        }
        
        .history-amount {
            font-weight: 700;
            font-size: 14px;
        }
        
        .history-amount.positive {
            color: var(--success);
        }
        
        .history-amount.negative {
            color: var(--danger);
        }
        
        .history-date {
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        /* Analytics */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .chart-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
        }
        
        .chart-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 15px;
        }
        
        .chart-placeholder {
            height: 200px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(99, 102, 241, 0.05) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .distribution-list {
            display: grid;
            gap: 10px;
        }
        
        .distribution-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .distribution-token {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .distribution-bar {
            width: 100%;
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .distribution-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 2px;
            transition: width 0.3s;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-primary);
        }
        
        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }
        
        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: 10px;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        [data-theme="dark"] .bottom-nav {
            background: rgba(30, 41, 59, 0.95);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-secondary);
        }
        
        .nav-item:hover {
            background: rgba(99, 102, 241, 0.1);
        }
        
        .nav-item.active {
            color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }
        
        .nav-icon {
            font-size: 20px;
        }
        
        .nav-label {
            font-size: 11px;
            font-weight: 600;
        }
        
        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s;
            z-index: 99;
        }
        
        .fab:hover {
            transform: scale(1.1) rotate(90deg);
        }
        
        .fab:active {
            transform: scale(0.95);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.2s;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: none;
            background: var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--text-secondary);
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: var(--danger);
            color: white;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 14px;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: all 0.3s;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .input-group {
            display: flex;
            gap: 8px;
        }
        
        .input-group .form-input {
            flex: 1;
        }
        
        /* Search Results */
        #searchResults {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            margin-top: 8px;
            display: none;
        }
        
        #searchResults.active {
            display: block;
        }
        
        .search-result-item {
            display: flex;
            align-items: center;
            padding: 12px;
            cursor: pointer;
            gap: 12px;
            transition: all 0.2s;
        }
        
        .search-result-item:hover {
            background: rgba(99, 102, 241, 0.1);
        }
        
        .search-result-item img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }
        
        .search-result-info {
            flex: 1;
        }
        
        .search-result-symbol {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .search-result-name {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Target Levels Editor */
        .targets-editor {
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 12px;
            background: rgba(99, 102, 241, 0.05);
        }
        
        .target-row {
            display: grid;
            grid-template-columns: 1fr 1fr 40px;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .target-input {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            background: var(--card-bg);
            color: var(--text-primary);
        }
        
        .remove-target-btn {
            padding: 6px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            height: 32px;
            transition: all 0.2s;
        }
        
        .remove-target-btn:hover {
            background: #dc2626;
        }
        
        .add-target-btn {
            width: 100%;
            margin-top: 8px;
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            background: var(--success);
            color: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            display: none;
            animation: slideInRight 0.3s;
            z-index: 2000;
            max-width: 350px;
        }
        
        .notification.show {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.warning {
            background: var(--warning);
        }
        
        .notification.info {
            background: var(--info);
        }
        
        .notification-icon {
            font-size: 20px;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .notification-message {
            font-size: 14px;
            opacity: 0.9;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Loading States */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .skeleton {
            background: linear-gradient(90deg, var(--border-color) 25%, rgba(99, 102, 241, 0.1) 50%, var(--border-color) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }
        
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
        
        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .empty-description {
            font-size: 14px;
            margin-bottom: 20px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }
            
            .header {
                padding: 15px;
                border-radius: 16px;
            }
            
            .logo-text {
                font-size: 18px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .portfolio-item-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .header-top {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Utilities */
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        .text-warning { color: var(--warning); }
        .text-info { color: var(--info); }
        .text-muted { color: var(--text-secondary); }
        
        .bg-success { background: var(--success); }
        .bg-danger { background: var(--danger); }
        .bg-warning { background: var(--warning); }
        .bg-info { background: var(--info); }
        
        .mt-1 { margin-top: 5px; }
        .mt-2 { margin-top: 10px; }
        .mt-3 { margin-top: 15px; }
        .mt-4 { margin-top: 20px; }
        
        .mb-1 { margin-bottom: 5px; }
        .mb-2 { margin-bottom: 10px; }
        .mb-3 { margin-bottom: 15px; }
        .mb-4 { margin-bottom: 20px; }
        
        .d-none { display: none; }
        .d-flex { display: flex; }
        .d-grid { display: grid; }
        
        .gap-1 { gap: 5px; }
        .gap-2 { gap: 10px; }
        .gap-3 { gap: 15px; }
        .gap-4 { gap: 20px; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="logo">
                    <div class="logo-icon">üìà</div>
                    <div class="logo-text">CryptoTracker Pro</div>
                </div>
                <div class="header-actions">
                    <button class="theme-toggle" onclick="toggleTheme()" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
                        <span id="themeIcon">üåô</span>
                    </button>
                    <button class="btn btn-sm btn-outline" onclick="exportData()">
                        üì• Export
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="syncAllPrices()">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>
            
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
                    <div class="stat-value" id="totalBalance">$0.00</div>
                    <div class="stat-change positive" id="balanceChange">+0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">P&L</div>
                    <div class="stat-value" id="totalPnL">$0.00</div>
                    <div class="stat-change" id="pnlChange">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">24h –∏–∑–º.</div>
                    <div class="stat-value" id="dayChange">$0.00</div>
                    <div class="stat-change" id="dayChangePercent">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–¢–æ–∫–µ–Ω–æ–≤</div>
                    <div class="stat-value" id="tokenCount">0</div>
                    <div class="stat-change" id="alertsCount">0 –∞–ª–µ—Ä—Ç–æ–≤</div>
                </div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('portfolio')">
                    <span class="tab-icon">üíº</span> –ü–æ—Ä—Ç—Ñ–µ–ª—å
                </button>
                <button class="tab" onclick="switchTab('alerts')">
                    <span class="tab-icon">üîî</span> –ê–ª–µ—Ä—Ç—ã
                </button>
                <button class="tab" onclick="switchTab('history')">
                    <span class="tab-icon">üìú</span> –ò—Å—Ç–æ—Ä–∏—è
                </button>
                <button class="tab" onclick="switchTab('analytics')">
                    <span class="tab-icon">üìä</span> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                </button>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="content-area">
            <!-- Portfolio Tab -->
            <div id="portfolioTab" class="tab-content active">
                <div class="portfolio-grid" id="portfolioGrid">
                    <div class="empty-state">
                        <div class="empty-icon">üíº</div>
                        <div class="empty-title">–ü–æ—Ä—Ç—Ñ–µ–ª—å –ø—É—Å—Ç</div>
                        <div class="empty-description">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å</div>
                        <button class="btn btn-primary" onclick="openAddTokenModal()">
                            + –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Alerts Tab -->
            <div id="alertsTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üîî –ê–∫—Ç–∏–≤–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã</h3>
                        <button class="btn btn-sm btn-outline" onclick="clearAllAlerts()">
                            –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                        </button>
                    </div>
                    <div class="alerts-list" id="alertsList">
                        <div class="empty-state">
                            <div class="empty-icon">üîï</div>
                            <div class="empty-title">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤</div>
                            <div class="empty-description">–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- History Tab -->
            <div id="historyTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìú –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
                        <select class="form-select" style="width: auto;" onchange="filterHistory(this.value)">
                            <option value="all">–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</option>
                            <option value="buy">–ü–æ–∫—É–ø–∫–∏</option>
                            <option value="sell">–ü—Ä–æ–¥–∞–∂–∏</option>
                            <option value="week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                            <option value="month">–ó–∞ –º–µ—Å—è—Ü</option>
                        </select>
                    </div>
                    <div class="history-list" id="historyList">
                        <div class="empty-state">
                            <div class="empty-icon">üìú</div>
                            <div class="empty-title">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>
                            <div class="empty-description">–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤—Å–µ –≤–∞—à–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Analytics Tab -->
            <div id="analyticsTab" class="tab-content">
                <div class="analytics-grid">
                    <div class="chart-container">
                        <h3 class="chart-title">üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è</h3>
                        <div class="distribution-list" id="distributionChart">
                            <div class="empty-state">
                                <div class="empty-icon">üìä</div>
                                <div class="empty-title">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3 class="chart-title">üìà –ò—Å—Ç–æ—Ä–∏—è –±–∞–ª–∞–Ω—Å–∞ (7–¥)</h3>
                        <div class="chart-placeholder">
                            –ì—Ä–∞—Ñ–∏–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3 class="chart-title">üéØ –¢–æ–ø performers</h3>
                        <div id="topPerformers" class="distribution-list">
                            <div class="empty-state">
                                <div class="empty-icon">üèÜ</div>
                                <div class="empty-title">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3 class="chart-title">üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
                        <div id="recommendations" style="padding: 10px;">
                            <div class="alert-item info">
                                <div class="alert-icon">üí°</div>
                                <div class="alert-content">
                                    <div class="alert-title">–°–æ–≤–µ—Ç –¥–Ω—è</div>
                                    <div class="alert-description">–î–∏–≤–µ—Ä—Å–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ –ø–æ—Ä—Ç—Ñ–µ–ª—å –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ä–∏—Å–∫–æ–≤</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('portfolio')">
                <span class="nav-icon">üíº</span>
                <span class="nav-label">–ü–æ—Ä—Ç—Ñ–µ–ª—å</span>
            </div>
            <div class="nav-item" onclick="switchTab('alerts')">
                <span class="nav-icon">üîî</span>
                <span class="nav-label">–ê–ª–µ—Ä—Ç—ã</span>
            </div>
            <div class="nav-item" onclick="switchTab('history')">
                <span class="nav-icon">üìú</span>
                <span class="nav-label">–ò—Å—Ç–æ—Ä–∏—è</span>
            </div>
            <div class="nav-item" onclick="switchTab('analytics')">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
            </div>
        </div>
        
        <!-- Floating Action Button -->
        <button class="fab" onclick="openAddTokenModal()">+</button>
    </div>
    
    <!-- Add/Edit Token Modal -->
    <div class="modal" id="tokenModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω</h3>
                <button class="modal-close" onclick="closeModal('tokenModal')">√ó</button>
            </div>
            
            <form id="tokenForm" onsubmit="saveToken(event)">
                <input type="hidden" id="editTokenId">
                
                <!-- Search Section -->
                <div id="searchSection">
                    <div class="form-group">
                        <label class="form-label">üîç –ü–æ–∏—Å–∫ —Ç–æ–∫–µ–Ω–∞</label>
                        <div class="input-group">
                            <input type="text" class="form-input" id="tokenSearch" 
                                   placeholder="Bitcoin, Ethereum, SOL..." 
                                   autocomplete="off" oninput="searchDebounce()">
                            <button type="button" class="btn btn-primary" onclick="searchTokens()">
                                –ù–∞–π—Ç–∏
                            </button>
                        </div>
                        <div id="searchResults"></div>
                    </div>
                </div>
                
                <input type="hidden" id="coingeckoId">
                
                <!-- Token Info -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–°–∏–º–≤–æ–ª</label>
                        <input type="text" class="form-input" id="tokenSymbol" readonly required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" class="form-input" id="tokenName" readonly required>
                    </div>
                </div>
                
                <!-- Purchase Details -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                        <input type="number" step="any" class="form-input" id="tokenAmount" 
                               placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ ($)</label>
                        <input type="number" step="any" class="form-input" id="tokenBuyPrice" 
                               placeholder="0.00" required>
                    </div>
                </div>
                
                <!-- Risk Management -->
                <div class="form-group">
                    <label class="form-label">‚õî Stop-Loss ($)</label>
                    <input type="number" step="any" class="form-input" id="tokenStopLoss" 
                           placeholder="–¶–µ–Ω–∞ –¥–ª—è –≤—ã—Ö–æ–¥–∞ —Å —É–±—ã—Ç–∫–æ–º">
                </div>
                
                <!-- Take Profit Targets -->
                <div class="form-group">
                    <label class="form-label">üéØ Take Profit —É—Ä–æ–≤–Ω–∏</label>
                    <div class="targets-editor" id="targetsEditor">
                        <div class="target-row">
                            <input type="number" step="any" class="target-input" 
                                   placeholder="–¶–µ–Ω–∞ TP1 ($)">
                            <input type="number" step="any" class="target-input" 
                                   placeholder="% –ø—Ä–æ–¥–∞–∂–∏">
                            <button type="button" class="remove-target-btn" 
                                    onclick="this.parentElement.remove()">√ó</button>
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline add-target-btn" 
                            onclick="addTargetRow()">
                        + –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å
                    </button>
                </div>
                
                <!-- Alert Preferences -->
                <div class="form-group">
                    <label class="form-label">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                    <div style="display: grid; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="alertOnStopLoss" checked>
                            <span>–ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ Stop-Loss</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="alertOnTarget" checked>
                            <span>–ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ü–µ–ª–µ–π</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="alertOnRSI" checked>
                            <span>RSI —Å–∏–≥–Ω–∞–ª—ã (–ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å/–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="alertOn24hChange" checked>
                            <span>–ò–∑–º–µ–Ω–µ–Ω–∏–µ >10% –∑–∞ 24—á</span>
                        </label>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div style="display: flex; gap: 12px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button type="button" class="btn btn-outline" onclick="closeModal('tokenModal')" 
                            style="flex: 1;">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Notification Container -->
    <div class="notification" id="notification">
        <span class="notification-icon" id="notificationIcon">‚úì</span>
        <div class="notification-content">
            <div class="notification-title" id="notificationTitle">–£—Å–ø–µ—à–Ω–æ</div>
            <div class="notification-message" id="notificationMessage">–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞</div>
        </div>
    </div>
    
    <script>
        // ==================== State Management ====================
        let portfolio = [];
        let alerts = [];
        let history = [];
        let nextTokenId = 1;
        let currentTheme = 'light';
        let autoUpdateInterval = null;
        let searchTimeout = null;
        
        // ==================== Initialization ====================
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            applyTheme();
            updateDisplay();
            startAutoUpdate();
            checkAlerts();
        });
        
        // ==================== Theme Management ====================
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme();
            localStorage.setItem('cryptoTheme', currentTheme);
        }
        
        function applyTheme() {
            document.body.setAttribute('data-theme', currentTheme);
            document.getElementById('themeIcon').textContent = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        }
        
        // ==================== Tab Navigation ====================
        function switchTab(tabName) {
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.closest('.tab').classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}Tab`).classList.add('active');
            
            // Update bottom nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.nav-item[onclick*="${tabName}"]`).classList.add('active');
            
            // Load specific tab data
            if (tabName === 'analytics') {
                updateAnalytics();
            }
        }
        
        // ==================== Modal Management ====================
        function openAddTokenModal() {
            document.getElementById('tokenForm').reset();
            document.getElementById('editTokenId').value = '';
            document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω';
            document.getElementById('searchSection').style.display = 'block';
            document.getElementById('targetsEditor').innerHTML = `
                <div class="target-row">
                    <input type="number" step="any" class="target-input" placeholder="–¶–µ–Ω–∞ TP1 ($)">
                    <input type="number" step="any" class="target-input" placeholder="% –ø—Ä–æ–¥–∞–∂–∏">
                    <button type="button" class="remove-target-btn" onclick="this.parentElement.remove()">√ó</button>
                </div>
            `;
            document.getElementById('searchResults').innerHTML = '';
            document.getElementById('tokenModal').classList.add('active');
        }
        
        function openEditTokenModal(tokenId) {
            const token = portfolio.find(t => t.id === tokenId);
            if (!token) return;
            
            document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω';
            document.getElementById('searchSection').style.display = 'none';
            document.getElementById('editTokenId').value = token.id;
            document.getElementById('coingeckoId').value = token.coingeckoId;
            document.getElementById('tokenSymbol').value = token.symbol;
            document.getElementById('tokenName').value = token.name;
            document.getElementById('tokenAmount').value = token.amount;
            document.getElementById('tokenBuyPrice').value = token.avgPrice;
            document.getElementById('tokenStopLoss').value = token.stopLoss || '';
            
            // Load targets
            const targetsEditor = document.getElementById('targetsEditor');
            targetsEditor.innerHTML = '';
            if (token.targets && token.targets.length > 0) {
                token.targets.forEach(target => {
                    addTargetRow(target.price, target.percentage);
                });
            } else {
                addTargetRow();
            }
            
            // Load alert preferences
            document.getElementById('alertOnStopLoss').checked = token.alerts?.stopLoss ?? true;
            document.getElementById('alertOnTarget').checked = token.alerts?.target ?? true;
            document.getElementById('alertOnRSI').checked = token.alerts?.rsi ?? true;
            document.getElementById('alertOn24hChange').checked = token.alerts?.change24h ?? true;
            
            document.getElementById('tokenModal').classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // ==================== Token Search ====================
        function searchDebounce() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(searchTokens, 500);
        }
        
        async function searchTokens() {
            const query = document.getElementById('tokenSearch').value;
            const resultsDiv = document.getElementById('searchResults');
            
            if (!query || query.length < 2) {
                resultsDiv.classList.remove('active');
                return;
            }
            
            resultsDiv.innerHTML = '<div style="padding: 20px; text-align: center;">üîç –ü–æ–∏—Å–∫...</div>';
            resultsDiv.classList.add('active');
            
            try {
                const response = await fetch(`https://api.coingecko.com/api/v3/search?query=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.coins.length === 0) {
                    resultsDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-secondary);">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }
                
                resultsDiv.innerHTML = data.coins.slice(0, 10).map(coin => `
                    <div class="search-result-item" onclick="selectToken('${coin.id}', '${coin.symbol.toUpperCase()}', '${coin.name}', '${coin.thumb}')">
                        <img src="${coin.thumb}" alt="${coin.name}">
                        <div class="search-result-info">
                            <div class="search-result-symbol">${coin.symbol.toUpperCase()}</div>
                            <div class="search-result-name">${coin.name}</div>
                        </div>
                        <div style="color: var(--text-secondary); font-size: 12px;">
                            #${coin.market_cap_rank || 'N/A'}
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                resultsDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--danger);">–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞</div>';
                console.error('Search error:', error);
            }
        }
        
        function selectToken(id, symbol, name, iconUrl) {
            document.getElementById('coingeckoId').value = id;
            document.getElementById('tokenSymbol').value = symbol;
            document.getElementById('tokenSymbol').dataset.iconUrl = iconUrl;
            document.getElementById('tokenName').value = name;
            document.getElementById('searchResults').classList.remove('active');
            document.getElementById('tokenSearch').value = `${name} (${symbol})`;
        }
        
        // ==================== Target Management ====================
        function addTargetRow(price = '', percentage = '') {
            const editor = document.getElementById('targetsEditor');
            const row = document.createElement('div');
            row.className = 'target-row';
            row.innerHTML = `
                <input type="number" step="any" class="target-input" placeholder="–¶–µ–Ω–∞ TP ($)" value="${price}">
                <input type="number" step="any" class="target-input" placeholder="% –ø—Ä–æ–¥–∞–∂–∏" value="${percentage}">
                <button type="button" class="remove-target-btn" onclick="this.parentElement.remove()">√ó</button>
            `;
            editor.appendChild(row);
        }
        
        // ==================== Save Token ====================
        function saveToken(event) {
            event.preventDefault();
            
            const editId = document.getElementById('editTokenId').value;
            const coingeckoId = document.getElementById('coingeckoId').value;
            
            if (!editId && !coingeckoId) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ –ø–æ–∏—Å–∫–∞', 'warning');
                return;
            }
            
            const tokenData = {
                coingeckoId: coingeckoId,
                symbol: document.getElementById('tokenSymbol').value,
                name: document.getElementById('tokenName').value,
                iconUrl: document.getElementById('tokenSymbol').dataset.iconUrl,
                amount: parseFloat(document.getElementById('tokenAmount').value),
                avgPrice: parseFloat(document.getElementById('tokenBuyPrice').value),
                stopLoss: parseFloat(document.getElementById('tokenStopLoss').value) || 0,
                targets: [],
                alerts: {
                    stopLoss: document.getElementById('alertOnStopLoss').checked,
                    target: document.getElementById('alertOnTarget').checked,
                    rsi: document.getElementById('alertOnRSI').checked,
                    change24h: document.getElementById('alertOn24hChange').checked
                }
            };
            
            // Collect targets
            document.querySelectorAll('#targetsEditor .target-row').forEach(row => {
                const price = parseFloat(row.children[0].value);
                const percentage = parseFloat(row.children[1].value);
                if (price > 0 && percentage > 0) {
                    tokenData.targets.push({ price, percentage });
                }
            });
            
            if (editId) {
                // Update existing token
                const index = portfolio.findIndex(t => t.id === parseInt(editId));
                if (index !== -1) {
                    portfolio[index] = { ...portfolio[index], ...tokenData };
                    addToHistory('edit', tokenData.symbol, tokenData.amount, tokenData.avgPrice);
                    showNotification(`${tokenData.symbol} –æ–±–Ω–æ–≤–ª–µ–Ω`, 'success');
                }
            } else {
                // Add new token
                tokenData.id = nextTokenId++;
                tokenData.currentPrice = tokenData.avgPrice;
                tokenData.totalInvested = tokenData.amount * tokenData.avgPrice;
                tokenData.dateAdded = new Date().toISOString();
                
                portfolio.push(tokenData);
                addToHistory('buy', tokenData.symbol, tokenData.amount, tokenData.avgPrice);
                showNotification(`${tokenData.symbol} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø–æ—Ä—Ç—Ñ–µ–ª—å`, 'success');
                
                // Fetch current price immediately
                fetchTokenPrice(tokenData.coingeckoId);
            }
            
            closeModal('tokenModal');
            updateDisplay();
            saveData();
        }
        
        // ==================== Price Updates ====================
        async function syncAllPrices() {
            if (portfolio.length === 0) return;
            
            const button = event.target;
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';
            
            const ids = portfolio.map(token => token.coingeckoId).join(',');
            const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true`;
            
            try {
                const response = await fetch(url);
                const prices = await response.json();
                
                portfolio.forEach(token => {
                    if (prices[token.coingeckoId]) {
                        const data = prices[token.coingeckoId];
                        token.currentPrice = data.usd;
                        token.change24h = data.usd_24h_change;
                        token.volume24h = data.usd_24h_vol;
                    }
                });
                
                checkAlerts();
                updateDisplay();
                saveData();
                showNotification('–¶–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω', 'error');
                console.error('Price sync error:', error);
            } finally {
                button.disabled = false;
                button.innerHTML = 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å';
            }
        }
        
        async function fetchTokenPrice(coingeckoId) {
            try {
                const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coingeckoId}&vs_currencies=usd&include_24hr_change=true`);
                const data = await response.json();
                
                if (data[coingeckoId]) {
                    const token = portfolio.find(t => t.coingeckoId === coingeckoId);
                    if (token) {
                        token.currentPrice = data[coingeckoId].usd;
                        token.change24h = data[coingeckoId].usd_24h_change;
                        updateDisplay();
                        saveData();
                    }
                }
            } catch (error) {
                console.error('Price fetch error:', error);
            }
        }
        
        function startAutoUpdate() {
            // Update prices every 30 seconds
            autoUpdateInterval = setInterval(() => {
                syncAllPrices();
            }, 30000);
        }
        
        // ==================== Alerts System ====================
        function checkAlerts() {
            portfolio.forEach(token => {
                const currentValue = token.amount * token.currentPrice;
                const pnl = currentValue - token.totalInvested;
                const pnlPercent = (pnl / token.totalInvested) * 100;
                
                // Stop-Loss Alert
                if (token.alerts?.stopLoss && token.stopLoss > 0 && token.currentPrice <= token.stopLoss) {
                    createAlert('sell', `${token.symbol} –¥–æ—Å—Ç–∏–≥ Stop-Loss`, 
                               `–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: $${token.currentPrice.toFixed(2)}, SL: $${token.stopLoss.toFixed(2)}`);
                }
                
                // Target Alerts
                if (token.alerts?.target && token.targets) {
                    token.targets.forEach((target, index) => {
                        if (token.currentPrice >= target.price && !target.triggered) {
                            createAlert('sell', `${token.symbol} –¥–æ—Å—Ç–∏–≥ Target ${index + 1}`, 
                                       `–¶–µ–Ω–∞: $${token.currentPrice.toFixed(2)}, –¶–µ–ª—å: $${target.price.toFixed(2)}`);
                            target.triggered = true;
                        }
                    });
                }
                
                // 24h Change Alert
                if (token.alerts?.change24h && Math.abs(token.change24h || 0) > 10) {
                    const type = token.change24h > 0 ? 'buy' : 'sell';
                    const direction = token.change24h > 0 ? '–≤—ã—Ä–æ—Å' : '—É–ø–∞–ª';
                    createAlert(type, `${token.symbol} ${direction} –Ω–∞ ${Math.abs(token.change24h).toFixed(1)}%`, 
                               '–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ 24—á');
                }
                
                // RSI Alerts (simulated)
                if (token.alerts?.rsi) {
                    // Simulate RSI based on 24h change
                    const simulatedRSI = 50 + (token.change24h || 0) * 2;
                    if (simulatedRSI > 70) {
                        createAlert('sell', `${token.symbol} –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω`, 
                                   `RSI: ${simulatedRSI.toFixed(0)} - –≤–æ–∑–º–æ–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è`);
                    } else if (simulatedRSI < 30) {
                        createAlert('buy', `${token.symbol} –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω`, 
                                   `RSI: ${simulatedRSI.toFixed(0)} - —Ö–æ—Ä–æ—à–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞`);
                    }
                }
            });
            
            updateAlertsList();
        }
        
        function createAlert(type, title, description) {
            // Check if similar alert already exists
            const exists = alerts.some(alert => 
                alert.title === title && 
                new Date() - new Date(alert.timestamp) < 3600000 // 1 hour
            );
            
            if (!exists) {
                alerts.unshift({
                    id: Date.now(),
                    type,
                    title,
                    description,
                    timestamp: new Date().toISOString()
                });
                
                // Keep only last 50 alerts
                if (alerts.length > 50) {
                    alerts = alerts.slice(0, 50);
                }
                
                saveData();
                updateAlertsList();
                
                // Show notification
                showNotification(title, type === 'buy' ? 'success' : type === 'sell' ? 'warning' : 'info');
            }
        }
        
        function updateAlertsList() {
            const alertsList = document.getElementById('alertsList');
            
            if (alerts.length === 0) {
                alertsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üîï</div>
                        <div class="empty-title">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤</div>
                        <div class="empty-description">–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π</div>
                    </div>
                `;
                return;
            }
            
            alertsList.innerHTML = alerts.map(alert => {
                const icon = alert.type === 'buy' ? 'üìà' : alert.type === 'sell' ? 'üìâ' : '‚ÑπÔ∏è';
                const timeAgo = getTimeAgo(new Date(alert.timestamp));
                
                return `
                    <div class="alert-item ${alert.type}">
                        <div class="alert-icon">${icon}</div>
                        <div class="alert-content">
                            <div class="alert-title">${alert.title}</div>
                            <div class="alert-description">${alert.description}</div>
                        </div>
                        <div class="alert-time">${timeAgo}</div>
                    </div>
                `;
            }).join('');
            
            // Update alerts count in stats
            document.getElementById('alertsCount').textContent = `${alerts.length} –∞–ª–µ—Ä—Ç–æ–≤`;
        }
        
        function clearAllAlerts() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∞–ª–µ—Ä—Ç—ã?')) {
                alerts = [];
                saveData();
                updateAlertsList();
                showNotification('–ê–ª–µ—Ä—Ç—ã –æ—á–∏—â–µ–Ω—ã', 'success');
            }
        }
        
        // ==================== History Management ====================
        function addToHistory(type, symbol, amount, price) {
            history.unshift({
                id: Date.now(),
                type,
                symbol,
                amount,
                price,
                value: amount * price,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 100 transactions
            if (history.length > 100) {
                history = history.slice(0, 100);
            }
            
            saveData();
            updateHistoryList();
        }
        
        function updateHistoryList(filter = 'all') {
            const historyList = document.getElementById('historyList');
            
            let filteredHistory = history;
            
            if (filter === 'buy') {
                filteredHistory = history.filter(h => h.type === 'buy');
            } else if (filter === 'sell') {
                filteredHistory = history.filter(h => h.type === 'sell');
            } else if (filter === 'week') {
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                filteredHistory = history.filter(h => new Date(h.timestamp) > weekAgo);
            } else if (filter === 'month') {
                const monthAgo = new Date();
                monthAgo.setMonth(monthAgo.getMonth() - 1);
                filteredHistory = history.filter(h => new Date(h.timestamp) > monthAgo);
            }
            
            if (filteredHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìú</div>
                        <div class="empty-title">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>
                        <div class="empty-description">–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤—Å–µ –≤–∞—à–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
                    </div>
                `;
                return;
            }
            
            historyList.innerHTML = filteredHistory.map(item => {
                const icon = item.type === 'buy' ? 'üì•' : item.type === 'sell' ? 'üì§' : '‚úèÔ∏è';
                const date = new Date(item.timestamp).toLocaleDateString('ru-RU');
                const time = new Date(item.timestamp).toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                
                return `
                    <div class="history-item">
                        <div class="history-left">
                            <div class="history-icon ${item.type}">${icon}</div>
                            <div class="history-details">
                                <div class="history-title">${item.type === 'buy' ? '–ü–æ–∫—É–ø–∫–∞' : item.type === 'sell' ? '–ü—Ä–æ–¥–∞–∂–∞' : '–ò–∑–º–µ–Ω–µ–Ω–∏–µ'} ${item.symbol}</div>
                                <div class="history-subtitle">${item.amount} @ $${item.price.toFixed(2)}</div>
                            </div>
                        </div>
                        <div class="history-right">
                            <div class="history-amount ${item.type === 'sell' ? 'positive' : 'negative'}">
                                ${item.type === 'sell' ? '+' : '-'}$${item.value.toFixed(2)}
                            </div>
                            <div class="history-date">${date} ${time}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function filterHistory(filter) {
            updateHistoryList(filter);
        }
        
        // ==================== Portfolio Display ====================
        function updateDisplay() {
            updatePortfolioGrid();
            updateStats();
            updateHistoryList();
            updateAlertsList();
        }
        
        function updatePortfolioGrid() {
            const grid = document.getElementById('portfolioGrid');
            
            if (portfolio.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üíº</div>
                        <div class="empty-title">–ü–æ—Ä—Ç—Ñ–µ–ª—å –ø—É—Å—Ç</div>
                        <div class="empty-description">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å</div>
                        <button class="btn btn-primary" onclick="openAddTokenModal()">
                            + –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
                        </button>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = portfolio.map(token => {
                const currentValue = token.amount * token.currentPrice;
                const pnl = currentValue - token.totalInvested;
                const pnlPercent = (pnl / token.totalInvested) * 100;
                const change24h = token.change24h || 0;
                
                // Check if any alert condition is met
                let alertIndicator = '';
                if (token.stopLoss > 0 && token.currentPrice <= token.stopLoss) {
                    alertIndicator = '<span style="color: var(--danger);">‚ö†Ô∏è SL</span>';
                } else if (token.targets?.some(t => token.currentPrice >= t.price)) {
                    alertIndicator = '<span style="color: var(--success);">üéØ TP</span>';
                }
                
                return `
                    <div class="portfolio-item" onclick="openEditTokenModal(${token.id})">
                        <div class="portfolio-item-header">
                            <div class="token-info">
                                <img src="${token.iconUrl}" class="token-icon" alt="${token.name}">
                                <div class="token-details">
                                    <div class="token-symbol">${token.symbol} ${alertIndicator}</div>
                                    <div class="token-name">${token.name}</div>
                                </div>
                            </div>
                            <div class="token-price">
                                <div class="current-price">$${token.currentPrice.toLocaleString('en-US', {maximumFractionDigits: 2})}</div>
                                <div class="price-change ${change24h >= 0 ? 'text-success' : 'text-danger'}">
                                    ${change24h >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(change24h).toFixed(2)}%
                                </div>
                            </div>
                        </div>
                        <div class="portfolio-item-stats">
                            <div class="item-stat">
                                <div class="item-stat-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
                                <div class="item-stat-value">${token.amount.toLocaleString('en-US', {maximumFractionDigits: 6})}</div>
                            </div>
                            <div class="item-stat">
                                <div class="item-stat-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</div>
                                <div class="item-stat-value">$${currentValue.toLocaleString('en-US', {maximumFractionDigits: 2})}</div>
                            </div>
                            <div class="item-stat">
                                <div class="item-stat-label">P&L</div>
                                <div class="item-stat-value ${pnl >= 0 ? 'text-success' : 'text-danger'}">
                                    ${pnl >= 0 ? '+' : ''}$${pnl.toLocaleString('en-US', {maximumFractionDigits: 2})}
                                    (${pnlPercent >= 0 ? '+' : ''}${pnlPercent.toFixed(2)}%)
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateStats() {
            const totalInvested = portfolio.reduce((sum, token) => sum + token.totalInvested, 0);
            const totalValue = portfolio.reduce((sum, token) => sum + (token.amount * token.currentPrice), 0);
            const totalPnL = totalValue - totalInvested;
            const pnlPercent = totalInvested > 0 ? (totalPnL / totalInvested * 100) : 0;
            
            // Calculate 24h change
            const dayChange = portfolio.reduce((sum, token) => {
                const change = token.amount * token.currentPrice * (token.change24h || 0) / 100;
                return sum + change;
            }, 0);
            const dayChangePercent = totalValue > 0 ? (dayChange / (totalValue - dayChange) * 100) : 0;
            
            // Update displays
            document.getElementById('totalBalance').textContent = `$${totalValue.toLocaleString('en-US', {maximumFractionDigits: 2})}`;
            document.getElementById('totalPnL').textContent = `$${totalPnL.toLocaleString('en-US', {maximumFractionDigits: 2})}`;
            document.getElementById('dayChange').textContent = `$${dayChange.toLocaleString('en-US', {maximumFractionDigits: 2})}`;
            document.getElementById('tokenCount').textContent = portfolio.length;
            
            // Update change indicators
            const balanceChange = document.getElementById('balanceChange');
            balanceChange.textContent = `${pnlPercent >= 0 ? '+' : ''}${pnlPercent.toFixed(2)}%`;
            balanceChange.className = `stat-change ${pnlPercent >= 0 ? 'positive' : 'negative'}`;
            
            const pnlChange = document.getElementById('pnlChange');
            pnlChange.textContent = `${pnlPercent >= 0 ? '+' : ''}${pnlPercent.toFixed(2)}%`;
            pnlChange.className = `stat-change ${pnlPercent >= 0 ? 'positive' : 'negative'}`;
            
            const dayChangePct = document.getElementById('dayChangePercent');
            dayChangePct.textContent = `${dayChangePercent >= 0 ? '+' : ''}${dayChangePercent.toFixed(2)}%`;
            dayChangePct.className = `stat-change ${dayChangePercent >= 0 ? 'positive' : 'negative'}`;
        }
        
        // ==================== Analytics ====================
        function updateAnalytics() {
            updateDistributionChart();
            updateTopPerformers();
            updateRecommendations();
        }
        
        function updateDistributionChart() {
            const chart = document.getElementById('distributionChart');
            
            if (portfolio.length === 0) {
                chart.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìä</div>
                        <div class="empty-title">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                    </div>
                `;
                return;
            }
            
            const totalValue = portfolio.reduce((sum, token) => sum + (token.amount * token.currentPrice), 0);
            
            chart.innerHTML = portfolio
                .sort((a, b) => (b.amount * b.currentPrice) - (a.amount * a.currentPrice))
                .map(token => {
                    const value = token.amount * token.currentPrice;
                    const percentage = (value / totalValue * 100).toFixed(1);
                    
                    return `
                        <div class="distribution-item">
                            <div class="distribution-token">
                                <img src="${token.iconUrl}" style="width: 24px; height: 24px; border-radius: 50%;">
                                <span>${token.symbol}</span>
                                <span style="color: var(--text-secondary);">${percentage}%</span>
                            </div>
                            <div style="text-align: right; color: var(--text-secondary);">
                                $${value.toLocaleString('en-US', {maximumFractionDigits: 2})}
                            </div>
                        </div>
                        <div class="distribution-bar">
                            <div class="distribution-fill" style="width: ${percentage}%;"></div>
                        </div>
                    `;
                }).join('');
        }
        
        function updateTopPerformers() {
            const container = document.getElementById('topPerformers');
            
            if (portfolio.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üèÜ</div>
                        <div class="empty-title">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                    </div>
                `;
                return;
            }
            
            const performers = portfolio.map(token => {
                const pnl = (token.amount * token.currentPrice) - token.totalInvested;
                const pnlPercent = (pnl / token.totalInvested * 100);
                return { ...token, pnl, pnlPercent };
            }).sort((a, b) => b.pnlPercent - a.pnlPercent);
            
            container.innerHTML = performers.slice(0, 5).map((token, index) => {
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
                
                return `
                    <div class="distribution-item">
                        <div class="distribution-token">
                            <span>${medal}</span>
                            <img src="${token.iconUrl}" style="width: 24px; height: 24px; border-radius: 50%;">
                            <span>${token.symbol}</span>
                        </div>
                        <div style="text-align: right; color: ${token.pnlPercent >= 0 ? 'var(--success)' : 'var(--danger)'};">
                            ${token.pnlPercent >= 0 ? '+' : ''}${token.pnlPercent.toFixed(2)}%
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function updateRecommendations() {
            const container = document.getElementById('recommendations');
            const recommendations = [];
            
            // Analyze portfolio
            const totalValue = portfolio.reduce((sum, token) => sum + (token.amount * token.currentPrice), 0);
            const avgPnl = portfolio.reduce((sum, token) => {
                const pnl = ((token.amount * token.currentPrice) - token.totalInvested) / token.totalInvested * 100;
                return sum + pnl;
            }, 0) / (portfolio.length || 1);
            
            // Generate recommendations
            if (portfolio.length < 3) {
                recommendations.push({
                    type: 'info',
                    title: '–î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è',
                    description: '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏–º–µ—Ç—å –º–∏–Ω–∏–º—É–º 3-5 —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ'
                });
            }
            
            if (avgPnl > 50) {
                recommendations.push({
                    type: 'warning',
                    title: '–§–∏–∫—Å–∞—Ü–∏—è –ø—Ä–∏–±—ã–ª–∏',
                    description: '–°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å >50%. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ —á–∞—Å—Ç–∏—á–Ω—É—é —Ñ–∏–∫—Å–∞—Ü–∏—é'
                });
            }
            
            if (avgPnl < -20) {
                recommendations.push({
                    type: 'info',
                    title: '–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π',
                    description: '–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è DCA —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø—Ä–∏ –Ω–∏–∑–∫–∏—Ö —Ü–µ–Ω–∞—Ö'
                });
            }
            
            const hasStopLoss = portfolio.filter(t => t.stopLoss > 0).length;
            if (hasStopLoss < portfolio.length / 2) {
                recommendations.push({
                    type: 'warning',
                    title: '–†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç',
                    description: '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Stop-Loss –¥–ª—è –∑–∞—â–∏—Ç—ã –∫–∞–ø–∏—Ç–∞–ª–∞'
                });
            }
            
            if (recommendations.length === 0) {
                recommendations.push({
                    type: 'success',
                    title: '–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!',
                    description: '–í–∞—à –ø–æ—Ä—Ç—Ñ–µ–ª—å —Ö–æ—Ä–æ—à–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω'
                });
            }
            
            container.innerHTML = recommendations.map(rec => `
                <div class="alert-item ${rec.type}" style="margin-bottom: 10px;">
                    <div class="alert-icon">üí°</div>
                    <div class="alert-content">
                        <div class="alert-title">${rec.title}</div>
                        <div class="alert-description">${rec.description}</div>
                    </div>
                </div>
            `).join('');
        }
        
        // ==================== Data Export ====================
        function exportData() {
            const data = {
                portfolio,
                history,
                alerts,
                exportDate: new Date().toISOString()
            };
            
            const csv = convertToCSV(portfolio);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `crypto-portfolio-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
        }
        
        function convertToCSV(data) {
            const headers = ['Symbol', 'Name', 'Amount', 'Buy Price', 'Current Price', 'Value', 'P&L', 'P&L %'];
            const rows = data.map(token => {
                const value = token.amount * token.currentPrice;
                const pnl = value - token.totalInvested;
                const pnlPercent = (pnl / token.totalInvested * 100).toFixed(2);
                
                return [
                    token.symbol,
                    token.name,
                    token.amount,
                    token.avgPrice,
                    token.currentPrice,
                    value.toFixed(2),
                    pnl.toFixed(2),
                    pnlPercent
                ];
            });
            
            return [headers, ...rows].map(row => row.join(',')).join('\n');
        }
        
        // ==================== Notifications ====================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : type === 'warning' ? '‚ö†' : '‚Ñπ';
            
            document.getElementById('notificationIcon').textContent = icon;
            document.getElementById('notificationTitle').textContent = 
                type === 'success' ? '–£—Å–ø–µ—à–Ω–æ' : 
                type === 'error' ? '–û—à–∏–±–∫–∞' : 
                type === 'warning' ? '–í–Ω–∏–º–∞–Ω–∏–µ' : '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è';
            document.getElementById('notificationMessage').textContent = message;
            
            notification.className = `notification show ${type}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        
        // ==================== Utility Functions ====================
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            if (seconds < 3600) return `${Math.floor(seconds / 60)} –º–∏–Ω. –Ω–∞–∑–∞–¥`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)} —á. –Ω–∞–∑–∞–¥`;
            if (seconds < 604800) return `${Math.floor(seconds / 86400)} –¥. –Ω–∞–∑–∞–¥`;
            
            return date.toLocaleDateString('ru-RU');
        }
        
        // ==================== Local Storage ====================
        function saveData() {
            const data = {
                portfolio,
                alerts,
                history,
                nextTokenId,
                version: '2.0'
            };
            localStorage.setItem('cryptoTrackerPro', JSON.stringify(data));
        }
        
        function loadData() {
            const saved = localStorage.getItem('cryptoTrackerPro');
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    portfolio = data.portfolio || [];
                    alerts = data.alerts || [];
                    history = data.history || [];
                    nextTokenId = data.nextTokenId || 1;
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            }
            
            // Load theme
            currentTheme = localStorage.getItem('cryptoTheme') || 'light';
        }
        
        // ==================== Cleanup ====================
        window.addEventListener('beforeunload', () => {
            if (autoUpdateInterval) {
                clearInterval(autoUpdateInterval);
            }
        });
    </script>
</body>
</html>