<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gold-digger Portfolio</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #6366f1; --success: #10b981; --danger: #ef4444; --warning: #f59e0b;
            --card-bg: #ffffff; --bg-color: #f1f5f9; --text-primary: #0f172a; 
            --text-secondary: #64748b; --border-color: #e2e8f0;
        }
        body.dark {
            --card-bg: #1c2431; --bg-color: #131720; --text-primary: #ffffff;
            --text-secondary: #7a8999; --border-color: #334155;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color); color: var(--text-primary);
            font-size: 14px; padding: 10px;
        }
        .app-container { max-width: 600px; margin: 0 auto; padding-bottom: 20px; }
        .header { background: var(--card-bg); border-radius: 16px; padding: 12px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .logo { display: flex; align-items: center; gap: 8px; font-size: 16px; font-weight: 700; }
        .btn { padding: 10px 16px; border: none; border-radius: 10px; font-size: 13px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 6px; transition: transform 0.1s; }
        .btn:active { transform: scale(0.95); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--border-color); color: var(--text-primary); }
        .btn.loading { pointer-events: none; }
        .loading-spinner { width: 14px; height: 14px; border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
        .stat-card { background: var(--bg-color); padding: 12px; border-radius: 12px; }
        .stat-label { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 4px; }
        .stat-value { font-size: 18px; font-weight: 700; }
        .portfolio-grid { display: grid; gap: 10px; }
        .portfolio-item { background: var(--card-bg); border-radius: 14px; padding: 12px; cursor: pointer; }
        .portfolio-item-header { display: flex; align-items: center; gap: 10px; }
        .token-icon { width: 36px; height: 36px; border-radius: 50%; }
        .token-info { flex-grow: 1; }
        .token-symbol { font-weight: 700; font-size: 14px; }
        .token-name { font-size: 11px; color: var(--text-secondary); }
        .token-value { text-align: right; }
        .current-value { font-size: 16px; font-weight: 700; }
        .pnl { font-size: 11px; font-weight: 600; }
        .text-success { color: var(--success); } .text-danger { color: var(--danger); }
        .add-token-btn { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: var(--primary); color: white; border: none; font-size: 24px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4); cursor: pointer; z-index: 99; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal.active { display: flex; align-items: flex-end; justify-content: center; }
        .modal-content { background: var(--card-bg); border-radius: 20px 20px 0 0; padding: 20px; width: 100%; max-height: 90vh; overflow-y: auto; animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .modal-title { font-size: 18px; font-weight: 700; }
        .modal-close { width: 32px; height: 32px; border-radius: 8px; border: none; background: var(--border-color); cursor: pointer; font-size: 20px; display:flex; align-items:center; justify-content:center;}
        .form-group { margin-bottom: 14px; }
        .form-label { display: block; font-size: 12px; font-weight: 600; margin-bottom: 6px; }
        .form-input { width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 10px; font-size: 14px; background-color: var(--bg-color); color: var(--text-primary); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        #searchResults { max-height: 150px; overflow-y: auto; border: 2px solid var(--border-color); border-radius: 10px; margin-top: 8px; display: none; }
        #searchResults.active { display: block; }
        .search-result-item { display: flex; align-items: center; padding: 10px; cursor: pointer; gap: 10px; }
        .search-result-item img { width: 28px; height: 28px; border-radius: 50%; }
        .editor { border: 2px solid var(--border-color); border-radius: 10px; padding: 12px; }
        .editor-row { display: grid; grid-template-columns: 1fr 1fr 40px; gap: 8px; align-items: center; margin-bottom: 8px; }
        .editor-input { width: 100%; padding: 6px 8px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 14px; }
        .remove-row-btn { width: 30px; height: 30px; background: var(--danger); color: white; border: none; border-radius: 4px; cursor: pointer; display:flex; align-items:center; justify-content:center;}
        .add-row-btn { width: 100%; margin-top: 8px; }
        .empty-state { text-align: center; padding: 40px 20px; color: var(--text-secondary); background: var(--card-bg); border-radius: 14px; }
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 12px 16px; background: #2c3e50; color: white; border-radius: 10px; font-size: 13px; font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.2); display: none; z-index: 2000; animation: slideDown 0.3s; }
        .toast.show { display: block; }
        @keyframes slideDown { from { transform: translate(-50%, -100%); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="logo">üí∞ Gold-digger</div>
                <div class="header-actions">
                    <button id="syncButton" class="btn btn-outline" onclick="syncPrices()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-label">–ë–∞–ª–∞–Ω—Å</div><div class="stat-value" id="totalBalance">$0.00</div></div>
                <div class="stat-card"><div class="stat-label">–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</div><div class="stat-value" id="totalInvested">$0.00</div></div>
                <div class="stat-card"><div class="stat-label">P&L</div><div class="stat-value" id="totalPnL">$0.00</div></div>
                <div class="stat-card"><div class="stat-label">USDT</div><div class="stat-value" id="freeUsdt">$0.00</div></div>
            </div>
        </div>
        <!-- Portfolio Grid -->
        <div class="portfolio-grid" id="portfolioGrid"><div class="empty-state">–ü–æ—Ä—Ç—Ñ–µ–ª—å –ø—É—Å—Ç</div></div>
        <!-- Floating Add Button -->
        <button class="add-token-btn" id="addTokenBtn">+</button>
    </div>

    <!-- Add/Edit Token Modal -->
    <div class="modal" id="tokenModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <form id="tokenForm" onsubmit="saveToken(event)">
                <input type="hidden" id="editTokenId">
                <div id="searchSection">
                    <div class="form-group">
                        <label class="form-label">–ü–æ–∏—Å–∫</label>
                        <div class="input-group"><input type="text" class="form-input" id="tokenSearch" placeholder="Bitcoin, ETH..." autocomplete="off"><button type="button" class="btn btn-primary" id="searchBtn">–ù–∞–π—Ç–∏</button></div>
                        <div id="searchResults"></div>
                    </div>
                </div>
                <input type="hidden" id="coingeckoId">
                <div class="form-row">
                    <div class="form-group"><label class="form-label">–°–∏–º–≤–æ–ª</label><input type="text" class="form-input" id="tokenSymbol" readonly required></div>
                    <div class="form-group"><label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" class="form-input" id="tokenName" readonly required></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label><input type="number" step="any" class="form-input" id="tokenAmount" placeholder="0.00" required></div>
                    <div class="form-group"><label class="form-label">–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ ($)</label><input type="number" step="any" class="form-input" id="tokenBuyPrice" placeholder="0.00" required></div>
                </div>
                <div class="form-group">
                    <label class="form-label">–¶–µ–ª–∏ (T1, T2, T3)</label>
                    <div class="editor" id="targetsEditor"></div>
                    <button type="button" class="btn add-row-btn btn-outline" onclick="addTargetRow()">+ –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</button>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–ª–∞–Ω DCA</label>
                    <div class="editor" id="dcaEditor"></div>
                    <button type="button" class="btn add-row-btn btn-outline" onclick="addDcaRow()">+ –î–æ–±–∞–≤–∏—Ç—å DCA</button>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" id="deleteTokenBtn" class="btn btn-danger" style="display:none;">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 10px; display:none;" id="tradeButtons">
                     <button type="button" class="btn btn-success" style="flex: 1;" onclick="openTradeModal('buy')">–ö—É–ø–∏—Ç—å –µ—â–µ</button>
                     <button type="button" class="btn btn-warning" style="flex: 1;" onclick="openTradeModal('sell')">–ü—Ä–æ–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Trade Modal -->
    <div class="modal" id="tradeModal">
         <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="tradeModalTitle">–û–ø–µ—Ä–∞—Ü–∏—è</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <form id="tradeForm" onsubmit="executeTrade(event)">
                <input type="hidden" id="tradeTokenId">
                <input type="hidden" id="tradeType">
                <div class="form-group"><label class="form-label">–¢–æ–∫–µ–Ω</label><input type="text" class="form-input" id="tradeTokenName" readonly></div>
                <div class="form-row">
                    <div class="form-group"><label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label><input type="number" step="any" class="form-input" id="tradeAmount" required></div>
                    <div class="form-group"><label class="form-label">–¶–µ–Ω–∞ ($)</label><input type="number" step="any" class="form-input" id="tradePrice" required></div>
                </div>
                <div class="form-group"><label class="form-label">–°—É–º–º–∞ ($)</label><input type="text" class="form-input" id="tradeTotal" readonly></div>
                <button type="submit" class="btn btn-primary" style="width:100%;">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // === STATE ===
        let portfolio = [];
        let freeUSDT = 0;
        let nextTokenId = 1;
        let activeModal = null;

        // === INITIALIZATION ===
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const tg = window.Telegram.WebApp;
                tg.ready(); tg.expand();
                if (tg.colorScheme === 'dark') document.body.classList.add('dark');
            } catch (e) { console.error("Telegram WebApp script not found."); }
            loadData();
            updateDisplay();
            setupEventListeners();
            syncPrices();
        });

        // === EVENT LISTENERS ===
        function setupEventListeners() {
            document.getElementById('addTokenBtn').addEventListener('click', openAddModal);
            document.querySelectorAll('.modal-close').forEach(btn => btn.addEventListener('click', closeModal));
            document.getElementById('searchBtn').addEventListener('click', searchTokens);
            document.getElementById('tokenSearch').addEventListener('input', () => { document.getElementById('coingeckoId').value = ''; });
            document.getElementById('tokenForm').addEventListener('submit', saveToken);
            document.getElementById('tradeForm').addEventListener('submit', executeTrade);
            document.getElementById('tradeAmount').addEventListener('input', updateTradeTotal);
            document.getElementById('tradePrice').addEventListener('input', updateTradeTotal);
            document.getElementById('deleteTokenBtn').addEventListener('click', () => {
                const tokenId = parseInt(document.getElementById('editTokenId').value);
                deleteToken(tokenId);
            });
        }
        
        // === MODALS ===
        function openModal(modalId) {
            activeModal = document.getElementById(modalId);
            if (activeModal) activeModal.classList.add('active');
            hapticFeedback('light');
        }

        function closeModal() {
            if (activeModal) activeModal.classList.remove('active');
            activeModal = null;
        }

        function openAddModal() {
            document.getElementById('tokenForm').reset();
            document.getElementById('modalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω';
            document.getElementById('editTokenId').value = '';
            document.getElementById('searchSection').style.display = 'block';
            document.getElementById('tradeButtons').style.display = 'none';
            document.getElementById('deleteTokenBtn').style.display = 'none';
            document.getElementById('targetsEditor').innerHTML = '';
            document.getElementById('dcaEditor').innerHTML = '';
            openModal('tokenModal');
        }

        function openEditModal(tokenId) {
            const token = portfolio.find(t => t.id === tokenId);
            if (!token) return;
            document.getElementById('modalTitle').textContent = `–ò–∑–º–µ–Ω–∏—Ç—å ${token.symbol}`;
            document.getElementById('editTokenId').value = token.id;
            document.getElementById('searchSection').style.display = 'none';
            document.getElementById('tradeButtons').style.display = 'flex';
            document.getElementById('deleteTokenBtn').style.display = 'block';
            
            document.getElementById('coingeckoId').value = token.coingeckoId;
            document.getElementById('tokenSymbol').value = token.symbol;
            document.getElementById('tokenName').value = token.name;
            document.getElementById('tokenAmount').value = token.amount;
            document.getElementById('tokenBuyPrice').value = token.avgPrice;
            
            const targetsEditor = document.getElementById('targetsEditor');
            targetsEditor.innerHTML = '';
            if (token.targets) token.targets.forEach(t => addTargetRow(t.price, t.percent));
            
            const dcaEditor = document.getElementById('dcaEditor');
            dcaEditor.innerHTML = '';
            if (token.dcaPlan) token.dcaPlan.forEach(d => addDcaRow(d.condition, d.amount));

            openModal('tokenModal');
        }
        
        function openTradeModal(type) {
            const tokenId = parseInt(document.getElementById('editTokenId').value);
            const token = portfolio.find(t => t.id === tokenId);
            if (!token) return;
            
            document.getElementById('tradeModalTitle').textContent = type === 'buy' ? `–ö—É–ø–∏—Ç—å ${token.symbol}` : `–ü—Ä–æ–¥–∞—Ç—å ${token.symbol}`;
            document.getElementById('tradeTokenId').value = tokenId;
            document.getElementById('tradeType').value = type;
            document.getElementById('tradeTokenName').value = `${token.name} (${token.symbol})`;
            document.getElementById('tradePrice').value = token.currentPrice;
            document.getElementById('tradeAmount').value = '';
            document.getElementById('tradeTotal').value = '$0.00';
            
            openModal('tradeModal');
        }

        // === API & DATA LOGIC ===
        async function saveToken(event) {
            event.preventDefault();
            const editId = document.getElementById('editTokenId').value;
            
            const commonData = {
                coingeckoId: document.getElementById('coingeckoId').value,
                symbol: document.getElementById('tokenSymbol').value,
                name: document.getElementById('tokenName').value,
                amount: parseFloat(document.getElementById('tokenAmount').value),
                avgPrice: parseFloat(document.getElementById('tokenBuyPrice').value),
                targets: Array.from(document.querySelectorAll('#targetsEditor .editor-row')).map(row => ({ price: parseFloat(row.children[0].value), percent: parseFloat(row.children[1].value) })).filter(t => t.price && t.percent),
                dcaPlan: Array.from(document.querySelectorAll('#dcaEditor .editor-row')).map(row => ({ condition: row.children[0].value, amount: parseFloat(row.children[1].value) })).filter(d => d.condition && d.amount),
            };

            if (editId) {
                const index = portfolio.findIndex(t => t.id === parseInt(editId));
                if (index > -1) {
                    portfolio[index] = { ...portfolio[index], ...commonData };
                    showToast(`${commonData.symbol} –æ–±–Ω–æ–≤–ª–µ–Ω`);
                }
            } else {
                if (!commonData.coingeckoId) { showToast('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ –ø–æ–∏—Å–∫–∞'); return; }
                const newToken = {
                    ...commonData,
                    id: nextTokenId++,
                    currentPrice: commonData.avgPrice,
                    totalInvested: commonData.amount * commonData.avgPrice,
                };
                portfolio.push(newToken);
                showToast(`${newToken.symbol} –¥–æ–±–∞–≤–ª–µ–Ω`);
            }

            closeModal();
            await syncPrices();
        }
        
        async function executeTrade(event) {
            event.preventDefault();
            const tokenId = parseInt(document.getElementById('tradeTokenId').value);
            const type = document.getElementById('tradeType').value;
            const amount = parseFloat(document.getElementById('tradeAmount').value);
            const price = parseFloat(document.getElementById('tradePrice').value);
            const index = portfolio.findIndex(t => t.id === tokenId);
            if (index === -1) return;
            const token = portfolio[index];

            if (type === 'buy') {
                const oldTotalValue = token.amount * token.avgPrice;
                const newPurchaseValue = amount * price;
                token.amount += amount;
                token.avgPrice = (oldTotalValue + newPurchaseValue) / token.amount;
                token.totalInvested = token.amount * token.avgPrice;
            } else { // sell
                if (amount > token.amount) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤'); return; }
                const sellValue = amount * price;
                freeUSDT += sellValue;
                const costOfSold = amount * token.avgPrice;
                token.totalInvested -= costOfSold;
                token.amount -= amount;

                if (token.amount < 0.000001) {
                    portfolio.splice(index, 1); // Remove token if fully sold
                }
            }
            closeModal();
            showToast(`–°–¥–µ–ª–∫–∞ ${type.toUpperCase()} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞`);
            updateDisplay();
            saveData();
        }
        
        function deleteToken(tokenId) {
            showConfirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω?', () => {
                portfolio = portfolio.filter(t => t.id !== tokenId);
                closeModal();
                showToast('–¢–æ–∫–µ–Ω —É–¥–∞–ª–µ–Ω');
                updateDisplay();
                saveData();
            });
        }

        async function syncPrices() {
            if (portfolio.length === 0) return;
            const syncButton = document.getElementById('syncButton');
            syncButton.classList.add('loading');
            syncButton.innerHTML = '<span class="loading-spinner"></span>';

            const ids = portfolio.map(t => t.coingeckoId).join(',');
            const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`;

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('API Error');
                const prices = await response.json();
                portfolio.forEach(t => {
                    if (prices[t.coingeckoId]) {
                        t.currentPrice = prices[t.coingeckoId].usd || t.currentPrice;
                        t.change24h = prices[t.coingeckoId].usd_24h_change || 0;
                    }
                });
            } catch (error) {
                console.error("Sync error:", error);
                showToast('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω');
            } finally {
                syncButton.classList.remove('loading');
                syncButton.innerHTML = '–û–±–Ω–æ–≤–∏—Ç—å';
                updateDisplay();
                saveData();
            }
        }
        
        // ... (Search functions: searchTokens, selectToken)

        // === UI & DISPLAY ===
        function updateDisplay() {
            updatePortfolioGrid();
            updateStats();
        }

        function updatePortfolioGrid() {
            const grid = document.getElementById('portfolioGrid');
            if (portfolio.length === 0) {
                grid.innerHTML = `<div class="empty-state">–ü–æ—Ä—Ç—Ñ–µ–ª—å –ø—É—Å—Ç</div>`; return;
            }
            grid.innerHTML = portfolio.map(token => {
                const currentValue = token.amount * token.currentPrice;
                token.totalInvested = token.amount * token.avgPrice; // Recalculate for consistency
                const pnl = currentValue - token.totalInvested;
                const pnlPercent = token.totalInvested > 0 ? (pnl / token.totalInvested * 100) : 0;
                return `
                    <div class="portfolio-item" onclick="openEditModal(${token.id})">
                        <div class="portfolio-item-header">
                            <div class="token-info">
                                <img src="${token.iconUrl}" class="token-icon">
                                <div class="token-details"><div class="token-symbol">${token.symbol}</div><div class="token-name">${token.name}</div></div>
                            </div>
                            <div class="token-value">
                                <div class="current-value">$${currentValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
                                <div class="pnl ${pnl >= 0 ? 'text-success' : 'text-danger'}">${pnl >= 0 ? '+' : ''}${pnl.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} (${pnlPercent.toFixed(1)}%)</div>
                            </div>
                        </div>
                    </div>`;
            }).join('');
        }
        
        function updateStats() {
            const totalInvested = portfolio.reduce((sum, t) => sum + t.totalInvested, 0);
            const totalValue = portfolio.reduce((sum, t) => sum + (t.amount * t.currentPrice), 0);
            const totalPnL = totalValue - totalInvested;

            document.getElementById('totalBalance').textContent = `$${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('totalInvested').textContent = `$${totalInvested.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('totalPnL').textContent = `$${totalPnL.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            document.getElementById('freeUsdt').textContent = `$${freeUSDT.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
        }

        // === HELPERS (DCA/Target rows, UI helpers) ===
        function addTargetRow(price = '', percent = '') { /* ... */ }
        function addDcaRow(condition = '', amount = '') { /* ... */ }
        function showToast(message) { /* ... */ }
        function hapticFeedback(type) { /* ... */ }
        function showConfirm(text, callback) { /* ... */ }
        
        // === STORAGE ===
        function saveData() {
            const data = { portfolio, freeUSDT, nextTokenId };
            localStorage.setItem('goldDiggerProData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('goldDiggerProData');
            if (saved) {
                const data = JSON.parse(saved);
                portfolio = data.portfolio || [];
                freeUSDT = data.freeUSDT || 0;
                nextTokenId = data.nextTokenId || 1;
            }
        }
    </script>
</body>
</html>
